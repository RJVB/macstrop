# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           github 1.0
set rustup.shim_cargo_portgroup yes
PortGroup           rustup 1.0
platform darwin {
    PortGroup       legacysupport 1.0
}

github.setup        rust-lang rustup 1.26.0

description         the rust toolchain installer

long_description    Rustup installs the rust programming language from the official release channels, \
                    enabling you to easily switch between stable, beta, and nightly compilers and keep \
                    them updated. It makes cross-compiling simpler with binary builds of the standard \
                    library for common platforms.
categories          devel
platforms           darwin linux
license             Apache-2

maintainers         nomaintainer

checksums           rmd160  14b43b157718a84d65e91427389b567c41ebe255 \
                    sha256  3f07d0f749772c28b2de0c4f3fd0a1cdf50fbd9fdf53b495f97f9490b42e50e7
#                     size    916383

depends_lib-append  port:curl \
                    port:xz \
                    port:libiconv

cargo.offline_cmd

if {[variant_isset rustup_build]} {
    # no point here in verifying how up-to-date cargo.lock is...
    configure.cmd   ${cargo.bin}
    configure.pre_args --version
}

destroot {
    xinstall -m 755 \
        ${worksrcpath}/target/[cargo.rust_platform]/release/${name}-init \
        ${destroot}${prefix}/bin/rustup
}

