# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           github 1.0
PortGroup           cmake 1.1
set LTO.allow_ThinLTO no
PortGroup           LTO 1.0

# github.setup        microsoft mimalloc 2.1.2 v
# github.tarball_from archive
github.setup        microsoft mimalloc 4e50d6714d471b72b2285e25a3df6c92db944593
fetch.type          git
distname            ${name}-git
version             2.1.2.14

categories          devel
license             MIT
maintainers         {outlook.com:mohd.akram @mohd-akram} openmaintainer

description         mimalloc is a compact general purpose allocator with \
                    excellent performance

long_description    mimalloc is a general purpose allocator with excellent \
                    performance characteristics.

checksums           rmd160  362b6ba6270889af10af46e41e469847a42b99a0 \
                    sha256  2b1bff6f717f9725c70bf8d79e4786da13de8a270059e4ba0bdd262ae7be46eb
#                     size    1163868

patch.pre_args      -Np1
patchfiles          patch-cmake.diff

cmake.save_configure_cmd "install log"

post-destroot {
    if {${os.platform} eq "darwin"} {
        xinstall -m 755 ${filespath}/mimalloc-darwin.sh ${destroot}${prefix}/bin/mimalloc.sh
    } else {
        xinstall -m 755 ${filespath}/mimalloc.sh ${destroot}${prefix}/bin
    }
    reinplace "s|@PREFIX@|${prefix}|g" ${destroot}${prefix}/bin/mimalloc.sh
}

test.run            yes
