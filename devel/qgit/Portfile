# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           qt5 1.0
PortGroup           cmake 1.1
PortGroup           github 1.0

fetch.type          git
github.setup        tibirna qgit 757c0fc17b879f5a5719e6959c926c997ef5c4f2
github.master_sites ${github.homepage}/archive
name                qgit
# qgit-2.9-10-g74fd5f4
# qgit-2.12-1-g757c0fc17b879f5a5719e6959c926c997ef5c4f2
version             2.12.1
categories          devel
maintainers         nomaintainer
description         A QT graphical interface to git repositories
long_description    qgit, a git GUI viewer. \
                    With qgit you will be able to browse revisions history, view patch content \
                    and changed files, graphically following different development branches. \

distname            ${name}-git
platforms           darwin linux

#use_gz             yes
worksrcdir          ${name}

depends_lib-append  port:git

patchfiles          patch_src_namespace_def.cpp.diff \
                    patch_src_qgit.cpp.diff \
                    patch-qt59-is-enough.diff
platform darwin {
    patchfiles-append \
                    patch-build-app-bundle.diff
}

post-patch {
    reinplace "s|@VERSION@|${version}|g" ${worksrcpath}/CMakeLists.txt
}

platform linux {
    cmake.install_rpath-prepend \
                ${qt_libs_dir}
}

configure.args-append \
                -DQT_PACKAGE=Qt5 \
                -DCMAKE_BUILD_WITH_INSTALL_RPATH:BOOL=ON

build.post_args -wk

platform darwin {
    destroot {
        xinstall -m 755 -d ${destroot}${qt_apps_dir}
        copy ${build.dir}/qgit.app ${destroot}${qt_apps_dir}

        # Also link to ${prefix}/bin for easier access from the command line
        # Especially useful since qgit is supposed to be started from
        # the GIT repository location.
        if {[info proc qt5.add_app_wrapper] ne ""} {
            qt5.add_app_wrapper qgit
        } else {
            system "echo \"#!/bin/sh\nexport KDE_SESSION_VERSION=5\nexec \\\"${qt_apps_dir}/qgit.app/Contents/MacOS/qgit\\\" \\\"\\\$\@\\\"\" > ${destroot}${prefix}/bin/qgit"
            system "chmod 755 ${destroot}${prefix}/bin/qgit"
        }
    }
}

github.tag_prefix ${name}-
