PortSystem      1.0
PortGroup       github 1.0
PortGroup       LTO 1.0

github.setup    Ocl-dev ocl-icd fdde6677b21329432db8b481e2637cd10f7d3cb2
version         2.2.3.112
distname        ${name}-git

fetch.type      git

categories      devel
platforms       darwin linux
license         BSD-2-Clause
maintainers     gmail.com:rjvbertin openmaintainer
description     OpenCL ICD Loader
long_description \
                an open source alternative to vendor-specific OpenCL ICD loaders.

depends_build-append \
                port:autoconf port:automake port:libtool \
                port:xmlto

pre-configure {
    if {![file exists ${worksrcpath}/configure]} {
        system -W ${worksrcpath} ./bootstrap
    }
}

configure.args-append \
                --libdir=${prefix}/lib/ocl-icd \
                --disable-silent-rules \
                --enable-pthread-once \
			 --enable-official-khronos-headers \
			 --enable-custom-vendordir=${prefix}/etc/OpenCL/vendors \
			 --enable-custom-layerdir=${prefix}/etc/OpenCL/layers \
			 --disable-update-database

post-destroot {
    file delete -force ${destroot}${prefix}/lib/pkgconfig
    file rename ${destroot}${prefix}/lib/ocl-icd/pkgconfig ${destroot}${prefix}/lib/
}

destroot.keepdirs \
                ${destroot}${prefix}/etc/OpenCL/vendors \
                ${destroot}${prefix}/etc/OpenCL/layers
