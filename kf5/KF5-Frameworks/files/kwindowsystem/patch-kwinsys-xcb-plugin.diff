diff --git CMakeLists.txt CMakeLists.txt
index 6412260..b884851 100644
--- CMakeLists.txt
+++ CMakeLists.txt
@@ -46,9 +46,9 @@ if(WIN32)
    find_package(Qt5WinExtras REQUIRED)
 endif()
 
-if (NOT APPLE)
-    find_package(X11)
-endif()
+#if (NOT APPLE)
+    find_package(X11 REQUIRED)
+#endif()
 
 set(KWINDOWSYSTEM_HAVE_X11 ${X11_FOUND})
 
diff --git autotests/CMakeLists.txt autotests/CMakeLists.txt
index f8e67f0..cbc8cec 100644
--- autotests/CMakeLists.txt
+++ autotests/CMakeLists.txt
@@ -13,6 +13,8 @@ add_subdirectory(helper)
 if (NOT APPLE)
     find_package(X11)
     find_package(XCB COMPONENTS XCB KEYSYMS)
+else()
+    unset(X11_FOUND)
 endif()
 
 macro(KWINDOWSYSTEM_UNIT_TESTS)
diff --git a/src/CMakeLists.txt b/src/CMakeLists.txt
index ee44bb3ad7910c610b1c78ff1fe7a7723a75364c..53506593bfe4231ca0f338853dcd69065ba8e844 100644
--- a/src/CMakeLists.txt
+++ b/src/CMakeLists.txt
@@ -22,9 +22,9 @@ ecm_qt_declare_logging_category(kwindowsystem_SRCS HEADER kwindowsystem_xcb_debu
 
 if (KWINDOWSYSTEM_HAVE_X11)
   set(kwindowsystem_SRCS ${kwindowsystem_SRCS}
-    platforms/xcb/kselectionowner.cpp
-    platforms/xcb/kselectionwatcher.cpp
-    platforms/xcb/kxerrorhandler.cpp
+#     platforms/xcb/kselectionowner.cpp
+#     platforms/xcb/kselectionwatcher.cpp
+#     platforms/xcb/kxerrorhandler.cpp
     platforms/xcb/kxutils.cpp
   )
 endif()
@@ -33,6 +33,7 @@ set(platformLinkLibraries)
 
 if (KWINDOWSYSTEM_HAVE_X11)
    include_directories(${CMAKE_CURRENT_SOURCE_DIR}/platforms/xcb)
+   include_directories(${Qt5X11Extras_INCLUDE_DIRS})
    if(NOT X11_Xrender_LIB)
       message(FATAL_ERROR "The XRender library could not be found. Please install the development package for it.")
    endif()
@@ -40,9 +41,10 @@ if (KWINDOWSYSTEM_HAVE_X11)
       message(FATAL_ERROR "The XFixes library could not be found. Please install the development package for it.")
    endif()
    set(platformLinkLibraries Qt5::X11Extras ${X11_LIBRARIES} ${X11_Xfixes_LIB} ${X11_Xrender_LIB} ${XCB_XCB_LIBRARY} ${XCB_KEYSYMS_LIBRARY})
-   set(kwindowsystem_SRCS ${kwindowsystem_SRCS} platforms/xcb/kkeyserver.cpp
-                                                platforms/xcb/kxmessages.cpp
-                                                platforms/xcb/netwm.cpp )
+#    set(kwindowsystem_SRCS ${kwindowsystem_SRCS} platforms/xcb/kkeyserver.cpp
+#                                                 platforms/xcb/kxmessages.cpp
+#                                                 platforms/xcb/netwm.cpp )
+   set(kwindowsystem_SRCS ${kwindowsystem_SRCS} platforms/xcb/netwm.cpp )
 endif ()
 
 if (APPLE)
@@ -52,7 +54,7 @@ if (APPLE)
 # FIXME: adjust kwindowinfo_mac to inherit from KWindowInfoPrivate
 #                                                 kwindowinfo_mac.cpp
 )
-  set(platformLinkLibraries "-framework CoreFoundation -framework Carbon")
+  set(platformLinkLibraries ${platformLinkLibraries} "-framework CoreFoundation -framework Carbon")
 endif ()
 
 if (WIN32)
diff --git src/config-kwindowsystem.h.cmake src/config-kwindowsystem.h.cmake
index 9692b35..4f9aaf3 100644
--- src/config-kwindowsystem.h.cmake
+++ src/config-kwindowsystem.h.cmake
@@ -1,5 +1,6 @@
 /* config-kwindowsystem.h. Generated by cmake from config-kwindowsystem.h.cmake */
 
+#ifndef KWINDOWSYSTEM_HAVE_X11
 /* Define to 1 if you have the Xlib */
 #cmakedefine01 KWINDOWSYSTEM_HAVE_X11
 
@@ -8,6 +9,13 @@
 
 /* Define to 1 if you have the Xrender library */
 #cmakedefine01 KWINDOWSYSTEM_HAVE_XRENDER
+#elif KWINDOWSYSTEM_HAVE_X11
+// XQuartz has XFixes and XRender, period.
+#undef KWINDOWSYSTEM_HAVE_XFIXES
+#define KWINDOWSYSTEM_HAVE_XFIXES true
+#undef KWINDOWSYSTEM_HAVE_XRENDER
+#define KWINDOWSYSTEM_HAVE_XRENDER true
+#endif
 
 /* Path to xcb plugin */
 #define XCB_PLUGIN_PATH "${KDE_INSTALL_FULL_PLUGINDIR}/kf5/org.kde.kwindowsystem.platforms/KF5WindowSystemX11Plugin.so"
diff --git src/kstartupinfo.cpp src/kstartupinfo.cpp
index 9582440..5f758c8 100644
--- src/kstartupinfo.cpp
+++ src/kstartupinfo.cpp
@@ -43,6 +43,8 @@ DEALINGS IN THE SOFTWARE.
 
 #include <config-kwindowsystem.h> // KWINDOWSYSTEM_HAVE_X11
 
+#define KWINDOWSYSTEM_HAVE_X11 0
+
 // need to resolve INT32(qglobal.h)<>INT32(Xlibint.h) conflict
 #ifndef QT_CLEAN_NAMESPACE
 #define QT_CLEAN_NAMESPACE
diff --git src/kusertimestamp.cpp src/kusertimestamp.cpp
index 3297a97..0593f73 100644
--- src/kusertimestamp.cpp
+++ src/kusertimestamp.cpp
@@ -21,6 +21,8 @@
 #include "kwindowsystem.h"
 #include <QGuiApplication>
 
+#define KWINDOWSYSTEM_HAVE_X11 0
+
 #if KWINDOWSYSTEM_HAVE_X11
 #include <netwm.h>
 #include <QX11Info>
diff --git src/platforms/xcb/CMakeLists.txt src/platforms/xcb/CMakeLists.txt
index b30bb55..172ffb9 100644
--- src/platforms/xcb/CMakeLists.txt
+++ src/platforms/xcb/CMakeLists.txt
@@ -5,6 +5,7 @@ set(xcb_plugin_SRCS
     kxerrorhandler.cpp
     kxutils.cpp
     plugin.cpp
+    netwm.cpp
 )
 
 add_library(KF5WindowSystemX11Plugin MODULE ${xcb_plugin_SRCS})
diff --git tests/CMakeLists.txt tests/CMakeLists.txt
index c0865d9..776e7fb 100644
--- tests/CMakeLists.txt
+++ tests/CMakeLists.txt
@@ -20,7 +20,7 @@ kwindowsystem_executable_tests(
   backgroundcontrasttest
 )
 
-if(KWINDOWSYSTEM_HAVE_X11)
+if(KWINDOWSYSTEM_HAVE_X11 AND NOT APPLE)
     kwindowsystem_executable_tests(icontest)
     target_link_libraries(icontest Qt5::X11Extras)
 endif()
