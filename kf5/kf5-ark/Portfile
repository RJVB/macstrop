# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# Copyright (c) 2015-2025 R.J.V. Bertin

PortSystem          1.0

set kf5.project     ark
set kf5.virtualPath applications
set kf5.category    utilities
PortGroup           kf5 1.1
# kf5.use_latest      applications

maintainers         gmail.com:rjvbertin openmaintainer

description         KDE file archive utility.
long_description    Ark is a graphical file compression/decompression utility \
                    with support for multiple formats, including tar, gzip, bzip2, \
                    rar, lrzip and zip, as well as CD-ROM images. Ark can be used to \
                    browse, extract, create, and modify archives.

subport ${name}-devel {
    description     ${description} This port follows git:origin/master
    long_description \
                    ${long_description} This port follows git:origin/master
}

if {${subport} eq "${name}-devel"} {
    conflicts       ${name}
    fetch.type      git
    kf5.git.shallowbefore \
                    2017-01-01
    #13ce7053229fa9469d8c8fdce4e44772bfe5fe98 ?
    kf5.git.setup   kde ark 2811c052b306df9a707395f56babd6be91a7eb2e
# #     v17.12.3-34-gccd538eb
#     git.branch      ccd538eb35305f1f4e489ae36c0c4e1978845bfb
    set release     20.03.90.17
    version         ${release}
    worksrcdir      ${name}-5
    distname        ${name}-5

    patch.pre_args  -Np1
    patchfiles-append \
                    patch-no-kf561.diff \
                    patch-no-qt510.diff \
                    patch-correct-version.diff

} else {
    conflicts       ${name}-devel
    checksums       rmd160  92a36e144911acf85056a7b0474b20364e4b313e \
                    sha256  dda9222e3d8bfea83997b46cf4f2f7b9677f9bc16463bf15223273f84eebbe7d
}

depends_lib-append  port:libarchive \
                    port:shared-mime-info \
                    port:zlib \
                    port:bzip2 \
                    port:xz

kf5.depends_frameworks \
                    karchive kconfig kcrash kdbusaddons \
                    ki18n kiconthemes kio kitemmodels kservice \
                    kparts kpty kwidgetsaddons
kf5.depends_build_frameworks \
                    kdoctools

kf5.allow_apidocs_generation no

platform darwin {
    compiler.blacklist *gcc* {clang <= 600} macports-clang-3.3 macports-clang-3.4 macports-clang-3.5
    foreach clv {3.6 3.7 3.8 3.9 4.0} {
        if {[file exists ${prefix}/bin/clang-mp-${clv}]} {
            compiler.whitelist-prepend macports-clang-${clv}
        }
        compiler.fallback-prepend macports-clang-${clv}
    }
#     compiler.fallback-prepend   macports-clang-4.0 macports-clang-3.9 macports-clang-3.8 macports-clang-3.7 macports-clang-3.6
}

build.post_args     -wk

platform darwin {
     kf5.kde4compat {
         post-destroot {
             file delete -force ${destroot}${prefix}/share/config.kcfg/ark.kcfg
             file delete -force ${destroot}${prefix}/share/icons
         }
     }
}

post-destroot {
    kf5.add_app_wrapper ark5 ark
}
