# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           makefile 1.0
PortGroup           save_configure_cmd 1.0

compwrap.add_compiler_flags yes

configure.save_build_cmd install

name                tap-plugins-ladspa

subport ladspa-sdk {}
if {${subport} eq "ladspa-sdk"} {
    description     The LADSPA SDK
    long_description The SDK for the Linux Audio Developer's Simple Plugin API (LADSPA)
    version         1.17
    master_sites    http://www.ladspa.org/download/
    distname        ladspa_sdk_${version}
    extract.suffix  .tgz
    checksums       rmd160  5955325ac25d140d93767a83b218d7906afff3a9 \
                    sha256  27d24f279e4b81bd17ecbdcc38e4c42991bb388826c0b200067ce0eb59d3da5b
#                     size    71053
    license         LGPL

    use_configure   no
    build.dir       ${worksrcpath}/src
    build.pre_args-delete \
                    all
    build.args-append \
                    INSTALL_PLUGINS_DIR=${prefix}/lib/ladspa \
                    INSTALL_INCLUDE_DIR=${prefix}/include \
                    INSTALL_BINARY_DIR=${prefix}/bin
    build.post_args-append -k

    destroot {
        xinstall -m 644 ${build.dir}/ladspa.h ${destroot}${prefix}/include/
        xinstall -m 755 \
                    ${worksrcpath}/bin/analyseplugin \
                    ${worksrcpath}/bin/listplugins \
                    ${destroot}${prefix}/bin
    }
    return
}

PortGroup           github 1.1
set LTO_needs_pre_build yes
PortGroup           LTO 1.0

default github.homepage \
                    {https://git.hq.sig7.se/${github.project}}
github.setup        "" tap-plugins 85640223047d49a305e90ba1b92303eb066ba474
fetch.type          git
name                tap-plugins-ladspa
version             20230707
distname            tap-plugins-git

categories          audio
platforms           darwin linux
license             GPL2
maintainers         nomaintainer
description         Tom's Audio Processing plugins
long_description    TAP-plugins is a bunch of LADSPA plugins for audio processing. It runs \
                    on the GNU/Linux operating system, and possibly other UNIX-like \
                    operating systems. (Although the author cannot verify the results, \
                    the source code can be compiled on Mac OS X and MS Windows as well.)
homepage            https://tomscii.sig7.se/tap-plugins/ladspa.html

depends_build       port:ladspa-sdk

patch.pre_args      -Np1
patchfiles-append   patch-Makefile.diff

use_configure       no

makefile.override-append PREFIX

build.post_args-append -wk OPTFLAGS=
